<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"class="no-webfont"><title>realazy: 输入法下 keyup 失效的解决方案</title><meta charset="utf-8"><meta name="viewport"content="width=device-width,initial-scale=1,viewport-fit=cover"><link rel="alternate"href="https://feeds.feedburner.com/realazy"type="application/atom+xml"title="Realazy"><link rel="stylesheet"href="/assets/style.min.css"><body id="post"><header><h1><a href="/">真・懒</a></h1><section><span><a href="/feed.atom">订阅</a></span> <span><a href="https://twitter.com/_cxa">Twitter</a></span> <span><a href="https://github.com/cxa">GitHub</a></span> <span><a href="mailto:xianan.chen@gmail.com">联系</a></span></section></header><main><h1>输入法下 keyup 失效的解决方案</h1><section class="meta"><time datetime="2007-10-31">二〇〇七年十月三十一日</time></section><p>在某些情况下，比如自动补全（auto complete）的输入框中，需要使用 <code>keyup</code> 事件来监听键盘的输入以迅速作出回应。<p>关键在于 <code>keyup</code>, 如果世界是美好的，那么就不会有这篇 blog. 可是……<p>世界是不美好的。我们活在中文世界，我们要用输入法。在输入法开启的情况下，您会碰到不美好的事情：<code>keyup</code> 失效。对于您绑定到 <code>keyup</code> 的任何回调函数，除非您把输入法切换回英文状态，否则它会无动于衷。如果能称之为 bug，我会很高兴，因为 bug 会有修复的可能，如果是特征（feature），那么，我只好叹息一下。<h2 id="">问题</h2><p>在开启输入法的情况下，三个浏览器的具体问题如下：<ul><li><strong>IE:</strong>触发 keydown 和 keyup, 不触发 keypress. 能够获得输入值。<li><strong>Firefox:</strong>触发 keydown 和 keypress, 不触发 keyup. 输入值未能获得。在回车后会触发 keyup, 可获得输入值。<li><strong>Opera:</strong>keydown, keypress 和 keyup 都不触发，输入值也未能获。</ul><p>（如果您能帮我试用一下 Safari，我会很高兴并谢谢您。这里有一个测试页面：<a href="http://tonextone.com/test/eventTest.html">http://tonextone.com/test/eventTest.html</a>）<h2 id="">解决方案</h2><p>总结出以上问题，没有兴奋反而陷入绝望，因为没有 google 出解决方案（是的，对于拉丁语系的老外来说，不会存在输入法）。但是，wait, 谷歌搜索的自动补全不是工作得好好的吗？于是研究一下这个 <a href="http://www.google.cn/ac.js">http://www.google.cn/ac.js</a>。嘿嘿，虽然混淆得还可以，但还是可以发现蛛丝马脚的。它使用一个计时器，当输入框处于聚焦（focus）状态时，每 10 毫秒执行一次回调函数。<p>虽然挺耗资源（所以建议在输入框失焦（blur）时，一定要清除这个计时器），但也只能如此了。作前端开发的，不仅要与语言（JavaScript, CSS, HTML） 斗，还要与浏览器斗，其乐无穷也。<p><strong>更新：</strong>IE 有一个 <code>onpropertychange</code> 事件处理器可以随时检测变化，对应之，Firefox 和 Opera 有一个 <code>oninput</code> 事件处理器也可以达到目的。遗憾的是，在输入法开启的情况下，Opera 对于 <code>oninput</code> 也没法随时监听（表现在：输入英文字母可以监听到，而中文则失效）。如果不考虑 Opera, IE 使用 <code>onpropertychange</code> 而 Firefox 使用 <code>oninput</code>, 也可解决我们上述问题。<p>另外需要注意的是， <code>oninput</code> 比较诡异，您可以 <code>&lt;input oninput=&quot;jsFunc()&quot; ... /&gt;</code> 来绑定，也可以用 <code>addEventListener</code> 来绑定，就是不能使用 DOM 0 的 <code>element.oninput = function(){}</code> 的形式来绑定，否则不生效。<p>未曾测试 Safari, 有心者可自行测试之。</main><footer><div class="intro"><img src="/assets/avatar.png"alt="头像"width="128"><p>我是陈贤安，喜欢钻研构建程序介面的技术，偏好静态类型函数式编程。常用编程语言有 JavaScript，会使 Swift、Objective-C、F# 和 OCaml。能看懂 C。realazy, 意取「真懒」，因为我相信，懒，对程序员来说，是一种美德。</div><p>2005 ～ 2023 © <span><a href="/">realazy</a></span> <span><a href="https://github.com/cxa/cxa.github.com.git">本站源码</a></span></footer><script src="/assets/highlight.js"></script><script src="/assets/script.js"></script>